# 第 3 章 控制结构

- [3.1 if](#31-if)
- [3.2 && 和 ||](#32--和-)
- [3.3 [[]]](#33-)
- [3.4 case](#34-case)
- [3.5 for](#35-for)

## 3.1 if

### 3.1.1 shell 中 if 语句的特点

- 跟的不是判断条件,而是语句
- 语句的退出状态码为 0 表示真,否则表示假
- if 必须以`;`或者换行结束

```shell
if cd "$1"; then
  echo 目录跳转成功
else
  echo 目录跳转失败
fi;
```

### 3.1.2 test 命令

`[`是一个命令,可以理解为 test 命令

- 必须以参数`]`结束
- 后面跟着若干用于判断的参数,必须用空格分开
- 变量用双引号包起来,避免单词拆分导致的问题

```shell
if [ "$name" == rww ]; then
  echo rww
else
  echo not rww
fi;
```

### 3.1.3 常用的比较运算符

字符串比较符

| 运算符       | 说明           |
| ------------ | -------------- |
| str1 = str2  | 相等           |
| str1 == str2 | 相等           |
| str1 != str2 | 不等           |
| -n str       | 非空(not null) |
| -z str       | 空(zero)       |
| str1 < str2  | 小于           |
| str1 > str2  | 大于           |

数值比较符(>=这些不能使用)

| 运算符        | 说明                  |
| ------------- | --------------------- |
| num1 -eq num2 | 相等(equal)           |
| num1 -ne num2 | 不等(not equal)       |
| num1 -lt num2 | 小于(less than)       |
| num1 -le num2 | 小于等于(less equal)  |
| num1 -gt num2 | 大于(great than)      |
| num1 -ge num2 | 大于等于(great equal) |

文件判断

| 运算符          | 说明                  |
| --------------- | --------------------- |
| -a/-e file      | 是否存在(exist)       |
| -d file         | 目录(directory)       |
| -f file         | 普通文件(file)        |
| -r file         | 可读权限(read)        |
| -w file         | 可写权限(write)       |
| -x file         | 可执行权限(execute)   |
| -s file         | 文件大小大于 0(size)  |
| file1 -nt file2 | 更新时间近 (new than) |
| file1 -ot file2 | 更新时间久(old than)  |

组合运算

| 运算符           | 说明    |
| ---------------- | ------- |
| 条件 1 -a 条件 2 | 与(and) |
| 条件 1 -o 条件 2 | 或(or)  |
| !条件            | 取反    |
| (条件)           | 分组    |

```shell
if [ -n "$1" -a ! -e "$1" ]; then
  touch $1
else
  echo 无法创建文件
fi;
```

## 3.2 && 和 ||

和 js 中的语法一致

- &&成功执行
- ||失败执行

```shell
if [ -n "$1" ] && [ ! -e "$1" ]; then
  touch $1
else
  echo 无法创建文件
fi;
```

## 3.3 [[]]

和[]一样是用在 if 语句里面的

[[]]和[]的区别

| 区别点   | [[]]         | []       |
| -------- | ------------ | -------- |
| 本质     | 条件判断语法 | 命令     |
| >,<, ()  | 支持         | 需要转义 |
| &&, \|\| | 支持         | 不支持   |
| 参数展开 | 不支持       | 支持     |
| 单词拆分 | 不支持       | 支持     |

注意

==, !=, =~右边的参数如果包含`*`等路径展开符,会被当成通配符使用

tips: shell 这种兼容场景太多,好容易混乱...难怪会有 google 的 zx 出现

## 3.4 case

- 可以使用通配符
- 可以使用`|`匹配多个值

```shell
case "$1" in
  *.txt)
    head "$1"
    ;;
  *.tar.gz | *.tgz)
    tar xzf "$1"
    ;;
  *)
    echo "not support"
    ;;
esac
```

## 3.5 for

单词列表一般使用可以展开为多个单词元素的类型

- 路径展开
- 数组
- 单词拆分

```shell
words='a b c d e'
for word in $words
do
  echo $word
done

```
