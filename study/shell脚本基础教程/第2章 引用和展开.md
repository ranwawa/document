# 第 2 章 引用和展开

- [2.1 路径展开](#21-路径展开)
- [2.2 大括号展开](#22-大括号展开)
- [2.3 波浪号展开](#23-波浪号展开)
- [2.4 参数展开](#24-参数展开)
- [2.5 命令替换](#25-命令替换)
- [2.6 算术表达式展开](#26-算术表达式展开)
- [2.7 引用](#27-引用)

## 2.1 路径展开

什么是路径展开

- 就是对路径中的特殊符号进行替换匹配
- `?`: 一个字符
- `*`: 字符串
- `[]`: 某个字符
- `[!]`: 以外的字符

路径开展的用途

- 主要用于`ls` `cp`等目录文件相关的命令中指定多个文件

路径展开的原理

- 由 shell 进行展开
- ls 等命令接收到的参数是展开后的结果

路径展开的注意事项

- 展开失败将作为字符串传给命令
- 展开其他目录时,不能跨目录范围
- 不能匹配开始的.

## 2.2 大括号展开

匹配多个单词,和路径展开的区别在于,如果不存在的文件同样会输出

```shell
#!/usr/bin/env zx
echo 第{1,2,,3}章
echo 第{1..5,a..d}章
echo 第{1..5..2}章
```

## 2.3 波浪号展开

`~用户名`等同于用户主目录

## 2.4 参数展开

即`$`输出变量

| 展开符号       | 含义                                                               |
| -------------- | ------------------------------------------------------------------ |
| ${name:=rww}   | name 为 unset 或空串 时输出 rww,并赋值给 name                      |
| ${name=rww}    | name 为 unset 时输出 rww,并赋值给 name                             |
| ${name:-rww}   | name 为 unset 或空串 时输出 rww ,类似 JS 中的`\|\|`                |
| ${name-rww}    | name 为 unset 时输出 rww                                           |
| ${name:?rww}   | name 为 unset 或空串 时输出 rww 到 stderr                          |
| ${name:+rww}   | name 有值时返回 rww,和:-相反,类似 JS 中的`&&`                      |
| ${name+rww}    | name 有值时(含空串)返回 rww                                        |
| ${name+rww}    | name 有值时(含空串)返回 rww                                        |
| ${name:1}      | 返回从下标 1 之后的内容,类似 JS 中的 substring                     |
| ${name: -1}    | 返回最后一个字符,注意和`:-`的区别                                  |
| ${name:1:3}    | 返回从下标 1 开始的 3 个字符                                       |
| ${name:1:-3}   | 返回从下标 1 开始到倒数第 3 个为止的字符, name 可以换成 数组[@]    |
| ${#name}       | 获取字符串长度                                                     |
| ${name#a}      | 删除左边第一个 a, 类似于 JS 中的`^a`可使用路径展开中的通配符`?*`等 |
| ${name##a}     | 删除左边最长匹配到的 a                                             |
| ${name%a}      | 删除右边第一个 a,类似 JS 中的`a$`                                  |
| ${name%%a}     | 删除右边最长匹配到的 a                                             |
| ${name/a/b}    | 将第 1 个 a 替换成 b,类似 vim 中的替换                             |
| ${name//a/b}   | 将所有 a 替换成 b,类似于正则中的/g                                 |
| ${name/#\*a/b} | 左边开始的 a 替换成 b                                              |
| ${name/%a\*/b} | 右边开始的 a 替换成 b                                              |

## 2.5 命令替换

将命令的标准输出作为字符串展开.可以自动去掉标准输出的换行符

```shell
echo 当前日期$(date +%Y-%m-%n)
```

## 2.6 算术表达式展开

3 种算术表达式形式

| 语法             | 特殊字符的处理                           | 返回值               | 类型   |
| ---------------- | ---------------------------------------- | -------------------- | ------ |
| declare -i a=1+2 | 不能有空格                               | 无                   | 数值   |
| ((a = 1 + 2))    | 可以有空格等特殊字符                     | 不等于 0 为真,0 为假 | 字符串 |
| let a=1+2        | 用单引号将表达式包起来就可以使用特殊符号 | 无                   | 字符串 |

通过`$(())`可以将表达式结果作为字符串展开

## 2.7 引用

3 种引用方式对比

|          | 特殊字符  |
| -------- | --------- |
| 反斜杠\  |           |
| 单引号'' | 全部失效  |
| 双引号"" | $,`,\可用 |
