# 编写可测试的 Javascript 代码

上个月在网络上随意看到这样一本书,想着自己要推广单元测试,需要系统的掌握一下如何编写更优质的单元测试代码,便入手了这本书.

拿到这本书,看了下出版日期,居然是 2015 年的.现在的单元测试框架主要是 jest 和 cypress.里面介绍的工具几乎都已经过时了.

不过还好.这本书并不是专门针对工具进行讲解的,更多的还是从技术层面讲解如何编写可测试的代码,这些思想是不会随着应用软件的更新而过时.所以决定今天把这些部分认真读一下,以指导自己的日常工作.

说实话,作者有点儿啰嗦.不过还是让我找出三个方面可以学习的东西.

1. 复杂度
2. 抽象工厂
3. 基于事件的架构

## 1. 复杂度

这些内容即使不写测试,也是需要遵守的.只不过写测试后,才能够深刻体会,如果不按照这些标准写代码,写测试会有多么痛苦.

- 扇出: 引用了多少外部函数和依赖了多少外部变量
- 扇入: 被多少包引入了
- 圈复杂度: 有多少分支结构
- 藕合度:
  - 内容耦合: 直接依赖另外一个函数
  - 公共耦合: 共通依赖外部变量
  - 控制耦合: 传参
  - 印记耦合: 部分参数
  - 数据耦合: 事件通知
  - 无耦合

对这几种耦合的解释还比较清晰,比之前考软件设计师时的认识更加具体了一点.

## 2. 抽象工厂

一直以来对抽象工厂的认识都局限在设计模式的学习上.但从未在代码中实际运用过.

作者从可测试角度来讲解一个普通函数,最终怎么优化到抽象工厂,提供了一个新的视角.似乎理解更清楚了些.

以后还是要抽时间把抽象工厂的具体实现再理一理,对实现还是没有完全清晰的认识.

## 3. 基于事件的架构

说实话,经历了 redux-saga 这种事件架构工具的折磨后,不想用这种太过于松散耦合的方式进行开发.项目变大之后,虽然代码层面的耦合确实降低了,但是依赖的地方特别多,对于新人太不友好,一个事件发出去,有特别多个地方要接收处理.很容易遗漏业务场景.

这种为了解耦而解耦的做法,实在不可取.

不过话说回来,他这整章的内容以后有时间还是要再来琢磨一下.事件架构到事件交换机是怎么一步一步来的,有啥区别.

现在只是不喜欢,但还是得了解到他是怎么实现的,才有充足的理由去反对他.
