### 业务背景

最近写商品详情,其中是有多规格多sku的对照.要实现点一个规格属性,相关联的无库存的sku禁止选中的功能.表面上看起来比较简单,但是前后花了2,
3天才完全搞得可以有bug

所以得详细记录一下,避免时间长之后又忘记思路了

数据存储
- 属性 [{颜色: [白色, 红色]}, {尺寸: s, m}, {皮质: 牛皮, 猪皮}]
- sku {白色s牛皮: 有货, 白色s猪皮: 无货, 白色m牛皮: 有货, 白色m猪皮:无货, 红色s牛皮: 有货, 红色s猪皮: 无货, 红色m牛皮:
有货, 红色m猪皮:无货,}
- 选中的 {颜色: '', 尺寸: '', 皮质: ''}


1. 点击(白色)高亮
2. 遍历每个属性除高亮的外即7次
3. 遍历sku,在sku里面找所有包含白色的,无货的 即白色s猪皮白色m猪皮
4. 同第2步,遍历7次.
5. 在第3步的结果里,判断该属性是否都出现过
6. 如果是则设置为禁用,否则设置为可点

如果点了白色,再点s
第2步只需遍历6次
第3步要判断包含白色或者s的sku库存

如果全点了
第2步只遍历5次
第3步则不用判断了,取所有的

如果一个也木有点(即初始化时)
第2步遍历8次
第3步取所有

初始化时可以通过默认选中一个有sku的倒推点了哪些属性,再判断



-----------------------------------------------
下面的有bug.上面的是重写的
------------------------------------------------

### 思路分析

1. 得想办法存储属性,sku,以及属性和sku关联的信息
2. 然后根据选择的某个属性,查找相关联所有其他属性
3. 判断这些属性组合的sku库存数量,设置禁用状态
4. 更新dom节点

### 代码实现

1. 存储相关数据的数据结构

一共用三张表,分别存储属性数组,sku的map集合,sku和属性的对应关系
- 属性数组
```
[{ label: 颜色, id: 1, values: [ { id: 11, label: 红色}, { id: 12, label:
蓝色 }]}, {label: 尺寸, id: 2, values: [{ id: 21, label: m}, { id: 22, label: l}]}]
```
- sku集合
```
{s001: { name: 红色m, inventory: 1}, {s002: { name: 蓝色l, inventory: 2}}
```
- sku和属性值组合的对照关系
```
[{path: 1:11;2:21, skuCode: s001 }, { path: 1:12;2:22,
skuCode: s002}]
```

2. 选择属性后,查找关联属性,比如选择了红色,要找到红色的所有组合所对应的sku
- 将点击过的属性值存到一个map里面 {1: 11, 2: 21}
- 能够拿到红色对应的值 1:11 如果是红色m的话就是1:11;2:21
- 遍历属性值组合,找到包含1:11的所有sku
- 再通过sku去sku集合里面判断该sku是否有库存
- 把没有库存的组合标记成新的数组 ['1:11;2:21']

3. 再设置状态
- 再返过来遍历属性数组,依次判断单个属性是否在没有库存的组合中
- 然后标记禁用状态


注意:
- 返过来设置状态时,要排除已经点击选择的属性值,因为它和某个组合有货才会被选中,和其他组合木有货
- 当只有一组属性时,即只有颜色时,就不能通过1:11去找sku了.因为其他组合都是1:12...所以这种情况要单独处理,直接排查其他属性值的库存
- 在页面初始加载时,要默认选中一个有库存的sku,然后根据这个sku的属性值组合
